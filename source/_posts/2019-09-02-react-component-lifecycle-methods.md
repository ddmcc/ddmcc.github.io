---
layout: post
title:  "Reactç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"
date:   2019-09-02 23:25:18
categories: å‰ç«¯
tags:  react
toc: true
---


 ã€€ã€€Reactç»„ä»¶çš„ä¸€ç”Ÿä¸»è¦åˆ†ä¸ºå››ä¸ªé˜¶æ®µåˆ†åˆ«ä¸ºåˆå§‹åŒ–ï¼ˆ`Initialization`ï¼‰ï¼ŒæŒ‚è½½ï¼ˆ`Mounting`ï¼‰ï¼Œæ›´æ–°ï¼ˆ`Updation`ï¼‰ï¼Œå¸è½½ï¼ˆ`Unmounting`ï¼‰ï¼Œ
 ä¸‹é¢ä»‹ç»æŒ‚è½½å’Œæ›´æ–°çš„ä¸€äº›æ–¹æ³•ã€‚


<!-- more -->

## 16.3ä¹‹å‰
 
![markdown](https://ddmcc-1255635056.file.myqcloud.com/f9d08583-fb5b-413f-82b0-9bd462cff551.png)
 
 ---
#### æŒ‚è½½é˜¶æ®µ

 ã€€ã€€æŒ‚è½½æ˜¯æŒ‡ç»„ä»¶æ¸²æŸ“å¹¶æ„é€ domå…ƒç´ ï¼Œç„¶åå°†å…ƒç´ æ’å…¥åˆ°é¡µé¢çš„è¿‡ç¨‹ï¼Œ **è¿™æ˜¯ä¸€ä¸ªä»æ— åˆ°æœ‰çš„è¿‡ç¨‹** ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š
 
 
 - componentWillMount
 
å®ƒä¼šåœ¨ç»„ä»¶æ¸²æŸ“ä¹‹å‰æ‰§è¡Œï¼Œåœ¨æ­¤æ–¹æ³•ä¹‹åï¼Œç»„ä»¶å°†æ¸²æŸ“æŒ‚è½½ï¼Œåœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”æ˜¯æœåŠ¡ç«¯æ¸²æŸ“å”¯ä¸€ä¼šè°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚~~æ‰€ä»¥å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚~~


- render

å°†ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚å®ƒæ˜¯ä¸€ä¸ª`çº¯æ–¹æ³•`ï¼Œè¾“å‡ºç”±è¾“å…¥å†³å®š


- componentDidMount

æ­¤æ–¹æ³•åœ¨ç”Ÿå‘½å‘¨æœŸä¸­ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨ç»„ä»¶æŒ‚è½½ä¹‹åã€‚åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå¯ä»¥è·å–åˆ°é¡µé¢çš„domèŠ‚ç‚¹ã€‚å­ç»„ä»¶çš„æ–¹æ³•ä¼šåœ¨çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨


#### æ›´æ–°é˜¶æ®µ

 ã€€ã€€æ›´æ–°é˜¶æ®µæ˜¯æŒ‡è°ƒç”¨setStateæˆ–propsæ”¹å˜è€Œè§¦å‘ï¼Œæˆ–è€…è°ƒç”¨`forceUpdate`æ¥é‡æ–°æ¸²æŸ“ç»„ä»¶å¹¶æŠŠç»„å»ºçš„å˜åŒ–æ˜¾ç¤ºåˆ°DOMå…ƒç´ çš„è¿‡ç¨‹ã€‚
 **è¿™æ˜¯ä¸€ä¸ªå˜åŒ–çš„è¿‡ç¨‹**
 
 - **1,å½“é€šè¿‡è°ƒç”¨setStateæ›´æ–°çŠ¶æ€è§¦å‘**
 
    - shouldComponentUpdate 
    
       æ­¤æ–¹æ³•åœ¨æ”¶åˆ°æ–°çš„propsæˆ–è€…çŠ¶æ€æ›´æ–°çš„è¿‡ç¨‹ä¸­ä¼šè¢«è°ƒç”¨ã€‚è§åçŸ¥æ„ï¼Œæ­¤æ–¹æ³•å¯ä»¥æ§åˆ¶ç»„ä»¶æ˜¯å¦è¦è¢«é‡æ–°æ¸²æŸ“ã€‚æ–¹æ³•è¿”å›trueæˆ–falseï¼Œå½“è¿”å›falseæ—¶ï¼Œç»„ä»¶ä¸ä¼šè¢«æ¸²æŸ“ã€‚é»˜è®¤è¿”å›ä¸ºtrue
    
     - componentWillUpdate
     
       æ­¤æ–¹æ³•å°†åœ¨`shouldComponentUpdate`è¿”å›ä¸ºtrueåè¢«è°ƒç”¨ï¼Œç±»ä¼¼`componentWillMount`ï¼Œåªä¸è¿‡å®ƒæ˜¯åœ¨æ¯æ¬¡è¢«é‡æ–°æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šè¢«è°ƒç”¨ä¸€æ¬¡
        
    - render
    
       åŒä¸Š
       
    - componentDidUpdate
    
      å½“ç»„ä»¶è¢«æ›´æ–°åˆ°DOMä¹‹åä¼šè¢«è§¦å‘
      
      
- **2,çˆ¶ç»„ä»¶ä¼ å…¥æ–°çš„props**

    - componentWillReceiveProps(nextProps)
    
      å½“ç»„ä»¶æ”¶åˆ°æ–°çš„propsä¼šè¢«è§¦å‘ï¼Œåœ¨é¦–æ¬¡æ¸²æŸ“ä¸ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥åˆ¤æ–­æ˜¯å¦è¦æ ¹æ®çˆ¶ç±»ä¼ å…¥æ–°çš„propsè€Œè¦æ›´æ”¹stateï¼Œåœ¨æ­¤æ–¹æ³•ä¸­è°ƒç”¨setStateä¸ä¼šé‡å¤æ¸²æŸ“

    - shouldComponentUpdate
    
      åŒä¸Š
      
    - componentWillUpdate
      
      åŒä¸Š
      
    - render
    
      åŒä¸Š
      
    - componentDidUpdate
    
      åŒä¸Š
      
      
- **3,è°ƒç”¨forceUpdate**

 ã€€ã€€å½“ä¸æƒ³é€šè¿‡stateæˆ–propsè¿›è¡Œæ”¹å˜è§¦å‘é‡æ–°æ¸²æŸ“æ—¶ï¼Œå¯ä»¥è°ƒç”¨forceUpdateï¼Œæ­¤æ“ä½œä¼šè·³è¿‡è¯¥ç»„ä»¶çš„ `shouldComponentUpdate`ã€‚ä½†å…¶å­ç»„ä»¶ä¼šè§¦å‘æ­£å¸¸çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒåŒ…æ‹¬`shouldComponentUpdate`æ–¹æ³•ã€‚
é€šå¸¸ä¸æ¨èä½¿ç”¨è¯¥æ–¹æ³•ã€‚


## 16.3ç‰ˆæœ¬

 ã€€ã€€åœ¨16.3ä¸­æ–°å¢`static getDerivedStateFromProps(nextProps, prevState)`å’Œ`getSnapshotBeforeUpdate(prevProps, prevState)`ï¼ŒåŒæ—¶åºŸå¼ƒäº†`componentWillMount`ï¼Œ`componentWillUpdate`ï¼Œ`componentWillReceiveProps`ä¸‰ä¸ªæ–¹æ³•ã€‚
 å…ˆè¯´ä¸ºä»€ä¹ˆè¦åºŸå¼ƒè¿™ä¸‰ä¸ªåœ¨æ¸²æŸ“ä¹‹å‰çš„æ–¹æ³•
 
 
 ã€€ã€€åœ¨React v16ä¸­å‘å¸ƒäº†React Fiberï¼Œç®€å•è¯´ä¸€ä¸‹Fiber
 
 > åœ¨ç°æœ‰Reactä¸­ï¼Œæ›´æ–°è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­è¦åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚è°ƒç”¨å„ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè®¡ç®—å’Œæ¯”å¯¹Virtual DOMï¼Œæœ€åæ›´æ–°DOMæ ‘ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥è¿›è¡Œçš„ã€‚
 >
 >Fiberå°±æ˜¯æŠŠæ‰€æœ‰ä»»åŠ¡åˆ†æˆä¸€ç‰‡ä¸€ç‰‡ï¼Œæ¯å½“æ‰§è¡Œå®Œä¸€ç‰‡ï¼Œå°±ä¼šç»™å…¶ä»–ä»»åŠ¡æ‰§è¡Œçš„æœºä¼šï¼ˆæ„Ÿè§‰å¯ä»¥çœ‹æˆçº¿ç¨‹ç«äº‰cpuæ—¶é—´ç‰‡ğŸ˜„ï¼‰ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å½“ä¸€ä¸ªæ›´æ–°ä»»åŠ¡è¿˜æ²¡å®Œæˆï¼Œå°±è¢«å…¶å®ƒä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡ç»™ä¸­æ–­äº†ã€‚
 >é‡ç‚¹æ˜¯è¢«ä¸­æ–­çš„ä»»åŠ¡ä¸æ˜¯åœ¨ä¸­æ–­çš„åœ°æ–¹æ¥ç€æ‰§è¡Œï¼Œå®ƒæ˜¯é‡æ–°å¼€å§‹çš„...é‡æ–°å¼€å§‹...
 >
 >Fiberåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µå…è®¸è¢«æ‰“æ–­ï¼Œè€Œç¬¬äºŒé˜¶æ®µåˆ™ä¸å…è®¸ã€‚ä»¥renderä¸ºç•Œï¼Œå¯ä»¥è¢«æ‰“æ–­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å°±æœ‰
 >
>- componentWillMount
>- componentWillReceiveProps
>- shouldComponentUpdate
>- componentWillUpdate
>- render

 ã€€ã€€**æ‰€ä»¥å¦‚æœåœ¨`componentWillMount`å’Œ`componentWillUpdate`åšä¸€äº›åå°æ•°æ®çš„è·å–æˆ–è€…å®šæ—¶å™¨çš„åˆå§‹åŒ–ç­‰çš„å·¥ä½œï¼Œå°†ä¸å†é€‚åˆï¼Œå› ä¸ºè¿™äº›æ–¹æ³•æœ‰å¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡**ã€‚å®˜æ–¹ä¸ºäº†ä¸è®©å¤§å®¶åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­ç»§ç»­åšä¸æ­£ç¡®çš„äº‹æƒ…ï¼Œ
 å¹²è„†æŠŠè¿™å‡ ä¸ªæ–¹æ³•ç»™åºŸå¼ƒäº†ï¼Œå¹¶æ¨å‡ºäº†æ–°çš„æ–¹æ³•`getDerivedStateFromProps`ï¼Œå¦‚æœä¹‹å‰åœ¨åºŸå¼ƒçš„æ–¹æ³•ä¸­çš„å®ç°æ¯”è¾ƒçº¯ï¼Œé‚£ä¹ˆç›´æ¥ç§»åˆ°æ–°çš„æ–¹æ³•ä¸­å³å¯ã€‚å®ƒæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨thisï¼Œç»“æœåªç”±è¾“å…¥å»æ”¹å˜ï¼Œ**è¿”å›çš„ç»“æœç›´æ¥ä¼ ç»™setState**ã€‚
 **å¦‚æœæ˜¯è¦å»åå°è·å–æ•°æ®æˆ–è€…åˆå§‹åŒ–çš„å·¥ä½œåˆ™å¯ä»¥ç§»åˆ°`componentWillMount`å’Œ`componentWillUpdate`æ–¹æ³•ä¸­**ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•ä¸ä¼šæœ‰è¢«æ‰§è¡Œå¤šæ¬¡çš„å¯èƒ½ã€‚
 
 ---

![markdown](https://ddmcc-1255635056.file.myqcloud.com/ab61714e-cb0e-429b-82ed-e5f03eff57f9.png)

 ---
 å›¾æ¥æºäº[http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/](http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)
 
#### æŒ‚è½½é˜¶æ®µ
 
- getDerivedStateFromProps
 
   `static getDerivedStateFromProps(nextProps, prevState)` è¿™æ˜¯ä¸€ä¸ªé™æ€çš„æ–¹æ³•ï¼Œä¼šä¼ å…¥æ–°çš„propså’ŒåŸæ¥çš„çŠ¶æ€å€¼ã€‚åœ¨è°ƒç”¨ render æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå®ƒåº”è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° stateï¼Œå¦‚æœè¿”å› null åˆ™ä¸ä¼šæ›´æ–°å†…å®¹ã€‚
   å®˜æ–¹æ–‡æ¡£ä¹Ÿè¯´äº†è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºstateçš„å€¼åœ¨ä»»ä½•æ—¶å€™éƒ½å–å†³äºpropsï¼Œå¦‚æœè¦åš **æœ‰å‰¯ä½œç”¨çš„æ“ä½œåˆ™åº”ä½¿ç”¨DidMountingï¼ŒDidUpdateæˆ–åœ¨propæ›´æ”¹æ—¶â€œé‡ç½®â€æŸäº›stateåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨å—æ§çš„ç»„ä»¶** 
   
   å¦‚å›¾æ­¤æ–¹æ³•ä¹Ÿå¯èƒ½ä¼šè¢«æš‚åœï¼Œä¸­æ–­æˆ–é‡æ–°å¼€å§‹ï¼Œå› ä¸ºå¤„äº`Render é˜¶æ®µ`
   
- render
 
    æ–¹æ³•ä¹Ÿå¯èƒ½ä¼šè¢«æš‚åœï¼Œä¸­æ–­æˆ–é‡æ–°å¼€å§‹
    
- componentDidMount
    
    åŒä¸Š
 
#### æ›´æ–°é˜¶æ®µ

- **1,è°ƒç”¨setStateæ›´æ–°çŠ¶æ€è§¦å‘**

    - shouldComponentUpdate
        
        è°ƒç”¨`setState`è§¦å‘çš„æ¸²æŸ“å¹¶ä¸ä¼šè°ƒç”¨getDerivedStateFromPropsï¼Œè€Œæ˜¯ç›´æ¥åˆ°äº†`shouldComponentUpdate`ã€‚**éœ€è¦æ³¨æ„çš„æ˜¯shouldComponentUpdateä¹Ÿæœ‰æ‰§è¡Œå¤šæ¬¡çš„å¯èƒ½**
     
    - render
    
        åŒæŒ‚è½½é˜¶æ®µï¼Œä¹Ÿå¯èƒ½å¤šæ¬¡æ‰§è¡Œ

    - getSnapshotBeforeUpdate(prevProps, prevState)
     
        è¿™ä¹Ÿæ˜¯åœ¨V16.3ä¸­æ–°åŠ å…¥çš„æ–¹æ³•ï¼Œåªæœ‰åœ¨æ›´æ–°é˜¶æ®µï¼Œ`render`æ–¹æ³•å’ŒçœŸæ­£DOMè¢«æ”¹å˜ä¹‹é—´æ‰§è¡Œï¼Œå¦‚å›¾è¿™æ—¶å¯ä»¥è¯»å–domï¼Œæ­¤æ–¹æ³•ä¸ä¼šè¢«ä¸­æ­¢æˆ–é‡æ–°å¼€å§‹ã€‚**æ–¹æ³•è¿”å›çš„å€¼ä¼šåœ¨`componentDidUpdate`æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥**
     
     >componentDidUpdate(prevProps, prevState, snapshot)
     
    - componentDidUpdate
    
       åŒä¸Š
     
 
- **2,çˆ¶ç»„ä»¶ä¼ å…¥æ–°çš„props**

    - getDerivedStateFromProps
    
        åœ¨æ›´æ–°é˜¶æ®µçš„`setState`æ–¹æ³•è€Œè§¦å‘çš„é‡æ–°æ¸²æŸ“ä¼šè¢«è°ƒç”¨ï¼Œè§£é‡Šå¦‚ä¸Šã€‚**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ–¹æ³•ä¹Ÿåœ¨â€œçº¯å‡€ä¸åŒ…å«å‰¯ä½œç”¨â€é˜¶æ®µï¼Œæ‰€ä»¥å¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ã€‚
        
    - shouldComponentUpdate 
    
        åŒä¸Š
        
    - render
    
        åŒä¸Š
        
    - componentDidUpdate
    
        åŒä¸Š
        
- **3,è°ƒç”¨forceUpdate**

    æ­¤è¿‡ç¨‹å’Œ16.3ä¹‹å‰ä¸€æ ·ä¼šç›´æ¥åˆ°renderæ–¹æ³•
    
    
## ^16.4

 ã€€ã€€åœ¨16.3ä¸­æ–°åŠ å…¥çš„`getDerivedStateFromProps`æ–¹æ³•åªæœ‰åœ¨æŒ‚è½½å’Œç”±`setState`å¼•èµ·çš„Updatingæ‰ä¼šè¢«æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥å›°æ‰°ï¼Œçˆ¶ç»„ä»¶ä¼ å…¥æ–°çš„propså’ŒforceUpdateå¹¶ä¸ä¼šUpdatingã€‚
 
 ã€€ã€€**åœ¨16.4ä¸­ï¼ŒReactå®˜æ–¹æ”¹æ­£äº†è¿™ä¸€ç‚¹ï¼Œæ— è®ºæ˜¯æŒ‚åœ¨é˜¶æ®µæˆ–æ˜¯ä»»ä½•åŠ¨ä½œå¼•èµ·çš„Updatingéƒ½ä¼šè§¦å‘`getDerivedStateFromProps`**ã€‚
 
 ã€€ã€€æ‰€ä»¥16.4çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¦‚ä¸‹å›¾ï¼š
 
    

![markdown](https://ddmcc-1255635056.file.myqcloud.com/3b8e2d83-7d94-4461-b053-c8a71435bb65.png)
---
 ã€€ã€€è§£é‡Šï¼šç•¥
      

## æ€»ç»“

 ã€€ã€€ç”¨é™æ€å‡½æ•°getDerivedStateFromPropsæ¥å–ä»£è¢«deprecateçš„å‡ ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå°±æ˜¯å¼ºåˆ¶å¼€å‘è€…åœ¨renderä¹‹å‰åªåšæ— å‰¯ä½œç”¨çš„æ“ä½œï¼Œè€Œä¸”èƒ½åšçš„æ“ä½œå±€é™åœ¨æ ¹æ®propså’Œstateå†³å®šæ–°çš„stateï¼Œå› ä¸ºåœ¨renderé˜¶æ®µç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ã€‚**åºŸå¼ƒçš„æ–¹æ³•ä¼šåœ¨17ç‰ˆæœ¬ä¸­åˆ é™¤**
 
 
## å‚è€ƒ

[https://zh-hans.reactjs.org/docs/react-component.html](https://zh-hans.reactjs.org/docs/react-component.html)

[React v16.3ä¹‹åçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°](https://zhuanlan.zhihu.com/p/38030418)

[React Fiberæ˜¯ä»€ä¹ˆ](https://zhuanlan.zhihu.com/p/26027085)

[http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/](http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)